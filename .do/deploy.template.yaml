spec:
  name: hausman-weg-management
  region: fra
  envs:
    - key: APP_ENV
      value: "prod"
    - key: APP_SECRET
      scope: RUN_AND_BUILD_TIME
      type: SECRET
    - key: DATABASE_URL
      scope: RUN_AND_BUILD_TIME
      value: ${hausmandb.DATABASE_URL}
    - key: MAILER_DSN
      scope: RUN_TIME
      value: "null://null"
  services:
    - name: hausman-web
      environment_slug: php
      github:
        repo: homeadmin24/hausman
        branch: main
        deploy_on_push: true
      http_port: 8080
      instance_count: 1
      instance_size_slug: basic-xxs
      build_command: |
        composer install --no-dev --optimize-autoloader
        npm install
        npm run build
        php bin/console doctrine:migrations:migrate --no-interaction
        php bin/console cache:clear
        php bin/console cache:warmup
      run_command: |
        heroku-php-nginx -C .do/nginx.conf public/
      routes:
        - path: /
      health_check:
        http_path: /health
        initial_delay_seconds: 10
        period_seconds: 10
        timeout_seconds: 5
        success_threshold: 1
        failure_threshold: 3
  databases:
    - name: hausmandb
      engine: MYSQL
      version: "8"
      production: false
      cluster_name: hausman-db-cluster
